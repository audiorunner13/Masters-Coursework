---
title: "Discussion Week 11"
author: "Peter Gatica"
date: "`r Sys.Date()`"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r message=FALSE}
# Load needed libraries
library(tidyverse)
library(readr)
library(knitr)
library(sqldf)
```

## Home Run Exit Velocity and Distance
##### I am creating a simple model to show if there is a direct correlation with the exit velocity of a ball hit out of the park and the distance that it travels.  I found a dataset that contains home run data between 2006 and 2017.  In the dataset are fields like exit velocity, distance, elevation angle, etc. The data was collected by the now discontinued hittrackeronline.com. I will be using only 2017 home run data.

```{r message=FALSE}
# filename <- "/Users/Audiorunner13/CUNY MSDS Course Work/DATA605 Fall 2022/Week 11/HR Tracker.csv"
filename <- tempfile()
download.file("https://raw.githubusercontent.com/audiorunner13/Masters-Coursework/main/DATA605%20Fall%202022/Week%2011/HR%20Tracker.csv",filename)

# hr_2017 <- read.csv.sql(filename, "select * from file where GAME_DATE > '04/01/2017' and EXIT_VELOCITY > 70", sep=",")
# count(hr_2017)
# hr_by_player_2017 <- (head(hr_2017,1000))
# head(hr_by_player_2017,50)
```
```{r}
stad_hr_2017_in <- read.csv.sql(filename, "select TRUE_DISTANCE, EXIT_VELOCITY, ELEVATION_ANGLE, HORIZONTAL_ANGLE, APEX, BALLPARK  from file where GAME_DATE > '01/01/2017' and EXIT_VELOCITY > 70", sep=",")
# head(stad_hr_2017_in,50)
hr_by_stad_2017 <- (head(stad_hr_2017_in,1000))
```
```{r}
coors_bp <- ifelse(hr_by_stad_2017$BALLPARK == 'Coors Field', 1, 0)
```
```{r}
(hr_by_stad_2017_out <- data.frame(TRUE_DISTANCE = hr_by_stad_2017$TRUE_DISTANCE, EXIT_VELOCITY = hr_by_stad_2017$EXIT_VELOCITY, ELEVATION_ANGLE = hr_by_stad_2017$ELEVATION_ANGLE , HORIZONTAL_ANGLE = hr_by_stad_2017$HORIZONTAL_ANGLE, APEX = hr_by_stad_2017$APEX, BALLPARK_NR = coors_bp))
```
```{r}
pairs(hr_by_stad_2017_out, gap=0.5, panel = panel.smooth, main = "Home Run data", col = 3 + (hr_by_stad_2017_out$BALLPARK_NR==1))
```

```{r}
plot(hr_by_stad_2017_out[,'EXIT_VELOCITY'],hr_by_stad_2017_out[,'TRUE_DISTANCE'],main="Home Runs Distance by Exit Velocity",xlab="Exit Velocity (mph)",ylab="Distance (ft)")
```

##### After creating a simple plot of the distance by the exit velocity of the hit ball, one will notice the right upward trend of distance as exit velocity increases.  The question is just how strong of a correlation is it.

```{r}
(stad_hr_2017_lm <- lm(TRUE_DISTANCE ~ EXIT_VELOCITY, data = hr_by_stad_2017_out))
```

##### I then use the linear model function to calculate the y-intercept and the slope and the residuals.  We fit the plot with an abline to illustrate if the data fits the model well.

```{r}
plot(TRUE_DISTANCE ~ EXIT_VELOCITY, data = hr_by_stad_2017_out)
abline(stad_hr_2017_lm, col='red')
```
```{r}
summary(stad_hr_2017_lm)
```
##### The large t-value ratio of 30.62 there is strong evidence of a correlation between the exit velocity of the hit ball and the distance that it travels. 

```{r}
plot(fitted(stad_hr_2017_lm),resid(stad_hr_2017_lm))
```
```{r}
qqnorm(resid(stad_hr_2017_lm))
qqline(resid(stad_hr_2017_lm))
```
```{r}
par(mfrow=c(2,2))
plot(stad_hr_2017_lm)
```

